{% extends "email/_base.html.twig" %}

{% trans_default_domain "email" %}

{% macro overview_table_row(title, overview) %}
    <tr>
        <td>{{ title }}</td>
        <td>{{ overview.openCount }} ({{ overview.openCountDelta }})</td>
        <td>{{ overview.resolvedCount }} ({{ overview.resolvedCountDelta }})</td>
        <td>{{ overview.closedCount }} ({{ overview.closedCountDelta }})</td>
    </tr>
{% endmacro %}

{% import _self as _local %}

{% block body %}
    <p>
        {{ "construction_sites_overview.message"|trans }}
    </p>
    {% for constructionSiteReport in body.constructionSiteReports %}
        <spacer size="15"></spacer>
        <h2>{{ constructionSiteReport.name }}</h2>
        <p>
            <a href="{{ constructionSiteReport.dashboardUrl }}">
                {{ "construction_sites_overview.to_dashboard"|trans }}
            </a>
        </p>
        <spacer size="5"></spacer>
        <table>
            <thead>
            <tr>
                <th>{{ "entity.name"|trans({}, "entity_craftsman") }}</th>
                <th>{{ "state_values.open"|trans({}, "entity_issue") }}</th>
                <th>{{ "state_values.resolved"|trans({}, "entity_issue") }}</th>
                <th>{{ "state_values.closed"|trans({}, "entity_issue") }}</th>
            </tr>
            </thead>
            <tbody>
            {% for craftsmanReport in constructionSiteReport.craftsmanReports %}
                {{ _local.overview_table_row(craftsmanReport.company, craftsmanReport) }}
            {% endfor %}
            {{ _local.overview_table_row("construction_sites_overview.total"|trans, constructionSiteReport) }}
            </tbody>
        </table>
    {% endfor %}
{% endblock %}
