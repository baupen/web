release:
  - composer install --verbose --prefer-dist --no-interaction --no-dev --optimize-autoloader --no-scripts
  - yarn install
  - yarn run encore production
  - rm -rf node_modules

shared:
  - var/persistent

writable:
  - var

env:
  - .env

warump:
  - php bin/console cache:clear -n
  - cp -r $PREVIOUS_RELEASE_PATH/var/transient var/transient

migration:
  - php bin/console doctrine:migrations:migrate -n

rollback_migration:
  - cd $PREVIOUS_RELEASE_PATH && export MIGRATE_TO=$(php bin/console doctrine:migrations:latest)
  - php bin/console doctrine:migrations:migrate $MIGRATE_TO -n

fixtures:
  - composer install --no-interaction --optimize-autoloader --no-scripts
  - php bin/console doctrine:fixtures:load -n